<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedido Confirmado - NovaShop</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/confirmacion.css}">
</head>
<body>

<!-- Navbar -->
<div th:replace="~{fragments/navbar :: navbar}"></div>

<!-- Página de Confirmación -->
<section class="confirmation-page">
    <div class="container">

        <!-- Card de Éxito -->
        <div class="confirmation-card">
            <div class="success-icon">
                <i class="bi bi-check-circle-fill"></i>
            </div>

            <h1 class="confirmation-title">¡Pedido Realizado con Éxito!</h1>

            <p class="lead text-muted mb-4">
                Gracias por tu compra. Tu pedido ha sido recibido y está siendo procesado.
            </p>

            <div class="order-number">
                <i class="bi bi-receipt me-2"></i>
                Pedido: <span th:text="${pedido.numeroPedido}">NS-202510-001234</span>
            </div>

            <p class="text-muted mt-3">
                Te hemos enviado un correo de confirmación a
                <strong th:text="${pedido.usuario.email}">tu@email.com</strong>
            </p>
        </div>

        <div class="row">

            <!-- Detalles del Pedido -->
            <div class="col-lg-8">
                <div class="order-details-card">

                    <!-- Productos Ordenados -->
                    <div class="detail-section">
                        <h4 class="detail-title">
                            <i class="bi bi-box-seam"></i>
                            Productos Ordenados
                        </h4>

                        <div th:each="detalle : ${pedido.detalles}">
                            <div class="order-item-row">
                                <img th:src="${!detalle.variante.producto.imagenes.isEmpty() ?
                                              detalle.variante.producto.imagenes[0].urlImagen :
                                              '/images/no-image.jpg'}"
                                     th:alt="${detalle.variante.producto.nombre}"
                                     class="item-image">

                                <div class="item-details">
                                    <div class="item-name"
                                         th:text="${detalle.variante.producto.nombre}">
                                        Producto
                                    </div>
                                    <div class="item-variant">
                                        Talla: <strong th:text="${detalle.variante.talla}">M</strong> |
                                        Color: <strong th:text="${detalle.variante.color}">Rojo</strong> |
                                        Cantidad: <strong th:text="${detalle.cantidad}">1</strong>
                                    </div>
                                </div>

                                <div class="item-price"
                                     th:text="'S/ ' + ${#numbers.formatDecimal(detalle.subtotal, 1, 2)}">
                                    S/ 89.90
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Resumen de Costos -->
                    <div class="detail-section">
                        <h4 class="detail-title">
                            <i class="bi bi-calculator"></i>
                            Resumen de Costos
                        </h4>

                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <strong th:text="'S/ ' + ${#numbers.formatDecimal(pedido.subtotal, 1, 2)}">
                                S/ 0.00
                            </strong>
                        </div>

                        <div class="summary-row">
                            <span>Costo de Envío:</span>
                            <strong th:if="${pedido.costoEnvio > 0}"
                                    th:text="'S/ ' + ${#numbers.formatDecimal(pedido.costoEnvio, 1, 2)}">
                                S/ 15.00
                            </strong>
                            <strong th:if="${pedido.costoEnvio == 0}" class="text-success">
                                GRATIS
                            </strong>
                        </div>

                        <div class="summary-row text-success" th:if="${pedido.descuento > 0}">
                            <span>Descuento:</span>
                            <strong th:text="'- S/ ' + ${#numbers.formatDecimal(pedido.descuento, 1, 2)}">
                                - S/ 0.00
                            </strong>
                        </div>

                        <div class="summary-row total">
                            <span>TOTAL PAGADO:</span>
                            <span th:text="'S/ ' + ${#numbers.formatDecimal(pedido.total, 1, 2)}">
                                S/ 0.00
                            </span>
                        </div>
                    </div>

                    <!-- Información de Envío -->
                    <div class="detail-section">
                        <h4 class="detail-title">
                            <i class="bi bi-truck"></i>
                            Información de Envío
                        </h4>

                        <p class="mb-2">
                            <strong>Dirección de Entrega:</strong>
                        </p>
                        <p class="text-muted mb-1" th:text="${pedido.direccionEnvio.nombreCompleto}">
                            Juan Pérez
                        </p>
                        <p class="text-muted mb-1" th:text="${pedido.direccionEnvio.direccionLinea1}">
                            Av. Principal 123
                        </p>
                        <p class="text-muted mb-1"
                           th:if="${pedido.direccionEnvio.direccionLinea2 != null}"
                           th:text="${pedido.direccionEnvio.direccionLinea2}">
                        </p>
                        <p class="text-muted mb-1"
                           th:text="${pedido.direccionEnvio.ciudad + ', ' + pedido.direccionEnvio.departamento}">
                            Lima, Lima
                        </p>
                        <p class="text-muted mb-0">
                            <i class="bi bi-telephone me-2"></i>
                            <span th:text="${pedido.direccionEnvio.telefono}">987654321</span>
                        </p>
                    </div>

                    <!-- Método de Pago -->
                    <div class="detail-section">
                        <h4 class="detail-title">
                            <i class="bi bi-credit-card"></i>
                            Método de Pago
                        </h4>

                        <p class="mb-0">
                            <span class="badge bg-primary p-2">
                                <i class="bi bi-check-circle me-2"></i>
                                <span th:text="${pedido.metodoPago}">TARJETA</span>
                            </span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Tracking y Acciones -->
            <div class="col-lg-4">

                <!-- Estado del Pedido -->
                <div class="order-details-card">
                    <h4 class="detail-title">
                        <i class="bi bi-map"></i>
                        Estado del Pedido
                    </h4>

                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-title">Pedido Recibido</div>
                            <div class="timeline-date"
                                 th:text="${#temporals.format(pedido.fechaPedido, 'dd/MM/yyyy HH:mm')}">
                                31/10/2025 14:30
                            </div>
                        </div>

                        <div class="timeline-item pending">
                            <div class="timeline-title">En Procesamiento</div>
                            <div class="timeline-date">Estimado: 1-2 días</div>
                        </div>

                        <div class="timeline-item pending">
                            <div class="timeline-title">En Camino</div>
                            <div class="timeline-date">Estimado: 3-4 días</div>
                        </div>

                        <div class="timeline-item pending">
                            <div class="timeline-title">Entregado</div>
                            <div class="timeline-date">Estimado: 5-7 días</div>
                        </div>
                    </div>

                    <div class="alert alert-info mt-4">
                        <i class="bi bi-info-circle me-2"></i>
                        <small>
                            Te notificaremos por email cada vez que el estado de tu pedido cambie.
                        </small>
                    </div>
                </div>

                <!-- Botones de Acción -->
                <div class="action-buttons mt-4">
                    <a th:href="@{/pedidos/{id}(id=${pedido.idPedido})}"
                       class="btn btn-primary">
                        <i class="bi bi-eye me-2"></i>
                        Ver Detalles
                    </a>
                    <a th:href="@{/productos}" class="btn btn-outline-primary">
                        <i class="bi bi-bag me-2"></i>
                        Seguir Comprando
                    </a>
                </div>

                <!-- Información Adicional -->
                <div class="info-box">
                    <h5>
                        <i class="bi bi-lightbulb me-2"></i>
                        ¿Qué sigue?
                    </h5>
                    <ul>
                        <li>Recibirás un correo con los detalles de tu pedido</li>
                        <li>Puedes rastrear tu pedido en "Mis Pedidos"</li>
                        <li>El tiempo de entrega es de 5-7 días hábiles</li>
                        <li>¿Problemas? Contáctanos al 999-888-777</li>
                    </ul>
                </div>

            </div>
        </div>

    </div>
</section>

<!-- Footer -->
<div th:replace="~{fragments/footer :: footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Confetti effect (opcional - celebración visual)
    window.addEventListener('load', function() {
        // Aquí podrías agregar un efecto de confeti con una librería
        console.log('¡Pedido confirmado con éxito!');
    });
</script>

</body>
</html>